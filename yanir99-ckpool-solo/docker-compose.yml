version: '3.7'

services:
  app_proxy:
    environment:
      APP_HOST: ckpool-solo_web_1
      APP_PORT: 80
    container_name: ckpool-solo_app_proxy_1
  init:
    image: alpine
    entrypoint: /bin/sh -c 'apk add envsubst && cat /conf/ckpool.conf.template | envsubst > /conf/ckpool.conf && chown 1000:1000 /conf/ckpool.conf'
    volumes:
      - ${APP_DATA_DIR}/conf:/conf
    environment:
      - APP_BITCOIN_NODE_IP=${APP_BITCOIN_NODE_IP}
      - APP_BITCOIN_RPC_USER=${APP_BITCOIN_RPC_USER}
      - APP_BITCOIN_RPC_PASS=${APP_BITCOIN_RPC_PASS}

  ckpool:
    image: pinkyswear/ckpool-solo
    depends_on:
      - init
    restart: on-failure
    stop_grace_period: 30s
    ports:
      - "5333:3333/tcp"
    volumes:
      - ${APP_DATA_DIR}/conf:/srv/ckpool/conf
      - ${APP_DATA_DIR}/logs:/srv/ckpool/logs
    container_name: ckpool-solo_ckpool_1

  #web:
  #  image: filebrowser/filebrowser
  #  ports: []
  #  volumes:
  #    - ${APP_DATA_DIR}/conf:/srv/conf
  #    - ${APP_DATA_DIR}/logs:/srv/logs
  #  environment:
  #    - FB_BASEURL=/web
  #  restart: on-failure
  #  container_name: ckpool-solo_web_1
  
  web:
    image: halverneus/static-file-server
    environment:
      - FOLDER=/web
      - PORT=80
    volumes:
      - ${APP_DATA_DIR}/ui:/web
      - ${APP_DATA_DIR}/logs:/web/logs
    restart: on-failure
    container_name: ckpool-solo_web_1
